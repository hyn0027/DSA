# Lab2 Report

## 不同哈希策略的实现

### 哈希策略

尽可能保证哈希值在哈希表中均匀分布

针对ascii：使用多项式法，前$k-1$个字符的哈希值$h$，第$k$个字符的ascii码值$c$，哈希表长质数$tablesize$，则前$k$个字符对应哈希值```(((h << 7) | (h >> 16)) + c) % tablesize```

针对utf8：改良多项式法。对单个字符，删去固定不变的码（如开头的1110）；对字节数不同的字符，在串尾加入各不相同的特征码；将01串当作二进制转为十进制得到原始字符值。对原始字符串应用多项式法，前$k$个字符对应哈希值```(((h << 16) | (h >> 7)) + c) % tablesize```

### 冲突处理策略

双向平方试探：私有变量```idx```表示已经进行了```idx```次试探。初始化将```idx```置为0。每次试探，在```last_choice```的基础上加第```idx+1```次试探相对于原哈希值的```bias```减去第```idx```次试探相对于原哈希值的```bias```得到新试探位置。```idx```加一后，返回新试探位置。

公共溢出区：取$\approx \frac {3}{4}$原哈希表长的一个质数作为新表长；剩余位置是公共溢出区。返回试探链时，如果```last_choice```在公共试探区外则返回公共试探区的第一个位置；否则返回```last_choice + 1```即公共试探区的下一个位置。

## 进行测试

六种数据由两种数据来源与三种数据特征组合构成

数据来源：poj.txt和hdu.txt，分别对应ascii和utf8

数据特征：

1. 共40000次操作，插入查询操作随机分布，总比例五五开
2. 共500000次操作，插入查询操作随机分布，总比例五五开
3. 共20000次操作，仅含插入操作

构造方法：

首先根据数据特征设定以下变量的值：操作数```dataset```，插入操作占比```p_insert```，查询操作占比```p_query```。

进行```dataset```次生成数据操作。每次有```p_insert```的概率是插入操作，```p_query```的概率是查询操作。对于插入操作，顺序读取对应文件的相应信息并输出；对于查询操作，如果尚未插入过任何数据则随机生成一个查询串，否则有一半的概率查询已经插入过的串，一半概率查询随机生成的串。

在结尾输出2结束。

## 分析结果

### 1

对比41~46行数据，针对ascii的策略处理utf8的耗时为针对utf8的策略的两倍。因为前者将utf8字符串映射到集中区域，易冲突。

### 2

哈希值分散时，线性试探略优，因计算简便；哈希值集中时，双向平方明显更优，41、42行对比甚至耗时相差十倍，因双向平方可更快跳出集中区间。

### 3

分情况。哈希值集中且冲突多时，开放散列优（如2、4行对比）。哈希值分散但仍有冲突时，封闭散列优（如44、46行对比）。

### 4

可能导致出现相似的字符串，它们对应的哈希值相近，映射不均匀，更可能冲突，使性能下降。

### 5

易定义字符串的偏序关系。建立一颗以字符串为键值的红黑  树，节点额外存储对应数字。单次插入查询为$O(logn)$，$n$为节点数。输入数据规模较大、哈希冲突严重时，红黑树时空消耗更少。

